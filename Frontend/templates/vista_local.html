{% extends "base.html" %}
{% block title %}Configuracion - AdminProp{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/vista_local.css') }}">
{% endblock %}
{% block content %}
<!-- DATOS PRINCIPALES -->
<section class="datos-principales">
    <div>
        <img src="https://ba-h.com.ar/wp-content/uploads/2018/10/galerias-pacifico-3.jpg" alt="imagen del local" class="imagen-local">
    </div>

    <div class="info-local">
        <div>
            <h4>Nombre del consorcio</h4>
            <h1 id="consorcioNombre">{{ unit.consortium_address }}</h1>
        </div>
        <div>
            <h4>Local Número</h4>
            <h1 id="numeroLocal">{{ unit.unit_name }}</h1>
        </div>
        <div>
            <h4>Cliente</h4>
            <div style="display:flex; align-items:center; gap:.75rem; justify-content: space-between;">
                <h1 data-nombre>{{ unit.tenant if unit.tenant }}</h1>
                {% if unit.tenant %}
                    <button type="button" id="btnDesocupar" class="btn btn-secondary" data-consortium-id="{{ consortium_id }}" data-unit-id="{{ unit.id }}">
                        Desocupar
                    </button>
                {% else %}
                    <form id="formOcupar" data-consortium-id="{{ consortium_id }}" data-unit-id="{{ unit.id }}">
                        <input type="text" id="inputInquilino" name="ocupar" placeholder="Nombre de nuevo inquilino">
                        <button type="submit" class="btn btn-primary">Establecer</button>
                    </form>
                {% endif %}
            </div>
        </div>
        <div>
            <h4>Deuda total</h4>
            <h1 class="deuda-total" data-deuda>${{ debt }}</h1>
            <button id="btnFormularioPagos" class="btn btn-secondary" data-consortium-id="{{ consortium_id }}" data-unit-id="{{ unit.id }}" data-tenant="{{ unit.tenant }}">Registrar pago</button>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <h2>Registrar pagos</h2>
            <form id="block-form">
                <table id="tabla-pagos">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Descripción</th>
                            <th>Monto</th>
                            <th>Seleccionar</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div class="actions">
                    <button type="button" id="btnRegistrarPagos">Registrar</button>
                    <button type="button" id="btnCancelarRegistroPago">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- RESUMEN -->
<section class="resumen-deuda">
    <table>
        <tr>
            <th>Descripción</th>
            <th></th>
        </tr>
        <tr>
            <td class="td-descripcion">Ocupado</td>
            <td class="td-informacion" id="tdOcupado">{{ 'Si' if unit.occupation_status else 'No' }}</td>
        </tr>
        <tr>
            <td class="td-descripcion">Último mes pago</td>
            <td class="td-informacion" id="tdUltimoMes">Septiembre 2025</td>
        </tr>
        <tr>
            <td class="td-descripcion">Valor de alquiler</td>
            <td class="td-informacion" id="tdAlquiler">
                ${{ unit.rent_value }}<button id="btnEditarAlquiler" class="btn btn-primary" data-unit-id="{{ unit.id }}" data-consortium-id="{{ consortium_id }}">
                    <span class="fa-solid fa-pen-to-square"></span>
                </button>
            </td>
        </tr>
        <tr>
            <td class="td-descripcion">Fin de contrato</td>
            <td class="td-informacion" id="tdFinContrato">—</td>
        </tr>
    </table>
    <div class="acciones-local">
        <button type="button" id="btnEliminar" class="boton-eliminar" data-consortium-id="{{ consortium_id }}" data-unit-id="{{ unit.id }}">Eliminar</button>
        <div id="mensaje-boton" style="display:none;"></div>
    </div>
</section>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/desocupar_unidad.js') }}"></script>
<script src="{{ url_for('static', filename='js/eliminar_unidad.js') }}"></script>
<script src="{{ url_for('static', filename='js/editar_alquiler.js') }}"></script>
<script src="{{ url_for('static', filename='js/registrar_pagos.js') }}"></script>
{% endblock %}