{% extends "base.html" %}
{% block title %}Comisiones - AdminProp{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/comisiones_styles.css') }}" />
{% endblock %}
{% block content %}
    <section class="page active">
        <h1>Gestión de comisión del administrador</h1>

        <!-- Filtros (un solo Calcular) -->
        <div class="form-row" style="margin-bottom:.5rem;">
            <label>Mes/Año
                <select id="selPeriodo">
                    <option>09/2025</option><option>08/2025</option><option>07/2025</option>
                </select>
            </label>
            <label>Propiedad/Consorcio
                <select id="selAmbito">
                    <option>Edificio San Martín 1234</option>
                    <option>Casa Av. Belgrano 456</option>
                </select>
            </label>
            <button id="btnCalcular" class="btn-primary">Calcular</button>
        </div>

        <!-- Banner de estado (verde) -->
        <div id="status" class="status">Cálculo listo.</div>

        <!-- Configuración (simple, sin botón duplicado) -->
        <fieldset style="margin:.5rem 0 0;">
            <legend>Configuración</legend>
            <div class="form-row">
                <label>% Comisión:
                    <input id="inpPct" type="number" value="5" min="0" max="100" style="width:80px;" /> %
                </label>
                <label><input type="radio" name="base" value="bruto" checked> Ingresos brutos</label>
                <label><input type="radio" name="base" value="neto"> Ingresos netos</label>
            </div>
            <label><input id="chkExcl" type="checkbox"> Excluir si admin = propietario</label>
        </fieldset>

        <!-- Resumen (como en propietarios) -->
        <div id="kpiWrap" class="kpis" style="display:none">
            <div class="kpi"><div>Total comisión</div><strong id="kpiTotal">$0</strong></div>
            <div class="kpi"><div>Unidades incluidas</div><strong id="kpiUnits">0</strong></div>
            <div class="kpi"><div>Promedio %</div><strong id="kpiPct">0%</strong></div>
        </div>

        <!-- Detalle colapsable -->
        <details id="detTabla" class="tablebox" open>
            <summary>Ver/ocultar detalle por unidad</summary>
            <table id="tbl">
                <thead>
                <tr>
                    <th>Propiedad / Unidad</th>
                    <th>Inquilino</th>
                    <th>Base $</th>
                    <th>%</th>
                    <th>Comisión $</th>
                    <th>Estado</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Dpto 1 - Piso 1</td><td>Juan P.</td><td>100000</td><td>5</td><td>5000</td><td>Incl.</td>
                </tr>
                <tr>
                    <td>Dpto 2 - Piso 1</td><td>Ana G.</td><td>120000</td><td>5</td><td>6000</td><td>Incl.</td>
                </tr>
                <tr>
                    <td>Dpto 3 - Piso 2</td><td>Vacío</td><td>0</td><td>-</td><td>-</td><td>Excl.</td>
                </tr>
                </tbody>
            </table>
            <p id="totales" style="margin-top:.4rem;">Totales: 10 incl. | 2 excl. | Comisión total: $55.000</p>
        </details>

        <!-- Acciones finales -->
        <div class="actions">
            <button id="btnAplicar" class="btn-primary" disabled>Aplicar a rendición</button>
            <button id="btnExportar" class="btn-secondary" disabled>Exportar</button>
        </div>
    </section>
{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static', filename='js/comisiones_toast&modal.js') }}"></script>
{% endblock %}
