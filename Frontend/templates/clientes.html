{% extends "base.html" %}
{% block title %}Clientes - AdminProp{% endblock %}
{% block head %}{% endblock %}

{% block content %}
    <section id="clientes" class="page active">
        <h1>Clientes</h1>
        <table>
            <thead>
            <tr>
                <th>Nombre</th>
                <th>Dirección</th>
                <th>Alquiler <button title="Ordenar"><i class="fa-solid fa-arrow-down"></i></button></th>
                <th>Deuda <button title="Ordenar"><i class="fa-solid fa-arrow-down"></i></button></th>
                <th>Pago <button title="Ordenar"><i class="fa-solid fa-arrow-down"></i></button></th>
                <th>Pago al día</th>
            </tr>
            </thead>
                   <tbody>
                        {% for client in clients %}
                        <tr>
                            <td>{{ client.nombre }}</td>
                            <td>{{ client.direccion }}</td>

                            <td data-value="{{ client.alquiler or 0 }}">${{ "{:,.2f}".format(client.alquiler or 0) }}</td>
                            <td data-value="{{ client.deuda or 0 }}">${{ "{:,.2f}".format(client.deuda or 0) }}</td>
                            <td data-value="{{ client.pago or 0 }}">${{ "{:,.2f}".format(client.pago or 0) }}</td>

                            <td>
                                {% if client.pago_al_dia %}
                                    <span title="Al día">&#9989;</span>
                                {% else %}
                                    <span title="Posee deuda">&#10060;</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="8" style="text-align: center;">No se encontraron clientes.</td>
                        </tr>
                    {% endfor %}
                    </tbody>
        </table>
        <div class="container-caja">
            <div class="caja">
                <h1>Ingresos mensuales</h1>
                <div class="bar-chart">
                    <div class="bar" style="height: 80%;">80%</div>
                    <div class="bar" style="height: 50%;">50%</div>
                    <div class="bar" style="height: 30%;">30%</div>
                </div>
            </div>
            <div class="caja">
                <h1>Pagos adeudados</h1>
                <div class="pie-chart"></div>
            </div>
            <div class="caja">
                <h1>Mapa propiedades</h1>
                <img src="{{ url_for('static', filename='img/city.jpg') }}" alt="alt">
            </div>
            <div class="caja">
                <h1>Calendario</h1>
                <div class="calendar">
                    <div class="calendar-header">
                        <button>&lt;</button>
                        <h2>Septiembre 2025</h2>
                        <button>&gt;</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>Lun</div>
                        <div>Mar</div>
                        <div>Mié</div>
                        <div>Jue</div>
                        <div>Vie</div>
                        <div>Sáb</div>
                        <div>Dom</div>
                    </div>
                    <div class="calendar-days">
                        <div class="empty"></div>
                        <div class="empty"></div>
                        <div>1</div>
                        <div>2</div>
                        <div>3</div>
                        <div>4</div>
                        <div>5</div>
                        <div>6</div>
                        <div>7</div>
                        <div>8</div>
                        <div>9</div>
                        <div>10</div>
                        <div>11</div>
                        <div>12</div>
                        <div>13</div>
                        <div>14</div>
                        <div>15</div>
                        <div>16</div>
                        <div>17</div>
                        <div>18</div>
                        <div>19</div>
                        <div>20</div>
                        <div>21</div>
                        <div>22</div>
                        <div>23</div>
                        <div>24</div>
                        <div>25</div>
                        <div>26</div>
                        <div>27</div>
                        <div>28</div>
                        <div>29</div>
                        <div>30</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    {% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableBody = document.querySelector('table tbody');
    const sortButtons = document.querySelectorAll('thead th button');

    sortButtons.forEach((button, index) => {
        button.addEventListener('click', () => {
            // Convertir las filas de la tabla en un array para poder ordenarlo
            const rows = Array.from(tableBody.querySelectorAll('tr'));

            // Obtener la dirección de ordenamiento actual (asc o desc)
            const currentOrder = button.dataset.order || 'desc';
            const newOrder = currentOrder === 'desc' ? 'asc' : 'desc';
            button.dataset.order = newOrder;

            // Cambiar el ícono de la flecha
            const icon = button.querySelector('i');
            icon.classList.toggle('fa-arrow-down');
            icon.classList.toggle('fa-arrow-up');

            rows.sort((rowA, rowB) => {
                const cellA = rowA.children[index + 2]; // +2 para saltar 'Nombre' y 'Dirección'
                const cellB = rowB.children[index + 2];

                const valueA = parseFloat(cellA.dataset.value || 0);
                const valueB = parseFloat(cellB.dataset.value || 0);

                if (newOrder === 'desc') {
                    return valueB - valueA;
                } else {
                    return valueA - valueB;
                }
            });

            // Volver a insertar las filas ordenadas en la tabla
            tableBody.innerHTML = ''; // Limpiar el contenido actual
            rows.forEach(row => tableBody.appendChild(row));
        });
    });
});
</script>
{% endblock %}
{% endblock %}